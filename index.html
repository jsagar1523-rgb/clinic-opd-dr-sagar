<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clinic OPD</title>

<style>
body{font-family:system-ui;background:#f4f6fb;padding:10px}
.card{background:#fff;padding:14px;border-radius:12px;margin-bottom:12px}
input,button{width:100%;padding:10px;margin-top:8px}
button{border:none;font-weight:600;color:#fff}
.primary{background:#2563eb}
.export{background:#7c3aed}
.danger{background:#b91c1c}
.queue-item{background:#e0e7ff;padding:8px;border-radius:8px;margin-top:6px}
</style>
</head>

<body>

<div class="card">
<label>Doctor Name</label>
<input id="doctor">
</div>

<div class="card">
<h3>Add Patient</h3>
<input id="pname" placeholder="Patient Name">
<input id="pmobile" placeholder="Mobile">
<button class="primary" onclick="addPatient()">Generate Token</button>
</div>

<div class="card">
<h3>Today Queue</h3>
<div id="queue"></div>
</div>

<div class="card">
<h3>Patient Records</h3>
<div>Total Collection: â‚¹ <span id="total">0</span></div>
<button class="export" onclick="exportCSV()">Download Report</button>
</div>

<div class="card">
<button class="danger" onclick="startNewDay()">Start New Day</button>
</div>

<script>
let data = JSON.parse(localStorage.getItem("opd")) || {token:1,records:[]}

function save(){
  localStorage.setItem("opd",JSON.stringify(data))
  render()
}

function addPatient(){
  if(!pname.value) return
  data.records.push({
    date:new Date().toLocaleDateString(),
    token:data.token++,
    name:pname.value,
    mobile:pmobile.value,
    fees:0
  })
  pname.value=""
  pmobile.value=""
  save()
}

function render(){
  queue.innerHTML=""
  let total=0
  data.records.forEach(r=>{
    queue.innerHTML+=`<div class="queue-item">Token ${r.token} - ${r.name}</div>`
    total+=Number(r.fees||0)
  })
  totalSpan.innerText=total
}

function exportCSV(){
  let csv="Date,Token,Name,Mobile,Fees\n"
  data.records.forEach(r=>{
    csv+=`${r.date},${r.token},${r.name},${r.mobile},${r.fees}\n`
  })
  let blob=new Blob([csv],{type:"text/csv"})
  let a=document.createElement("a")
  a.href=URL.createObjectURL(blob)
  a.download="clinic-report.csv"
  a.click()
}

function startNewDay(){
  if(confirm("Delete all data?")){
    data={token:1,records:[]}
    save()
  }
}

const totalSpan=document.getElementById("total")
render()
</script>

</body>
</html>
